---
title: "DA_IA_Alzbeta_Reinhardova"
author: "Alzbeta Reinhardova 6180079"
date: '28.10.2022'
output:
  pdf_document:
    toc: yes
    number_sections: yes
  html_document:
    theme: flatly
    toc: yes
    toc_float: yes
    df_print: paged
---
# Individual Assignment - EBC4263/4
Topic: Regression Analysis, Interactions and AN(C)OVA, Diff-in-Diff, Panel Data.

### **General information**: 

This assignment focus on applying all the data analytical techniques discussed in this course, namely Regression Analysis, Interactions and AN(C)OVA, Diff-in-Diff and Panel Data. You will independently develop and carry out a research project that has the following three important qualities: it is well motivated, properly designed, and feasible to implement. Furthermore, you will interpret the empirical results obtained from the data analysis in R, present and communicate the findings in a meaningful way and provide management implications for managerial decision making. Please consult the rubric for an overview of the grading scheme.

### **Deliverable**

Please submit one zip file (not 7zip, rar or another format), named **DA_IA_firstname_lastname.zip** containing:

  * One file with code in R script or R-markdown named **DA_IA_firstname_lastname.R** or **DA_IA_firstname_lastname.Rmd** respectively.
  * One pdf file with your analysis, named **DA_IA_firstname_lastname.pdf**. This file can be obtained from knitting your R-Markdown file. If you cannot knit your R-markdown you are required to create a file, which you will convert to pdf, that mimicks an R-markdown file, containing all the code, output of code evaluations and comments, reasoning, findings, interpretations, etc.
  
For the R script:
  * The code must run.
  * Add a comment on why or which functions you will use from a given R package.
  * There are appropriate comments throughout the R script that will help to understand it.
  * If you use R-markdown, make sure that the knitted pdf file contains the code.

For the pdf file:
  * Be succinct, to the point.
  * Ensure there are no grammatical or spelling errors.
  * Ensure that this pdf file has all information about your analysis, including but not limited to your code, output of code evaluations and comments, reasoning, findings, and interpretations.


### **Deadline**

Please upload the zip file to Canvas on **Friday 28th of October 2022 before 12:00h (Noon) Maastricht time**. This is a hard deadline, so make sure you upload your file well in time.

### **Plagiarism and referencing**

In order to protect the reputation of the degrees that you – as students – receive, instances of cheating or plagiarism are treated extremely seriously.

Fraud, including plagiarism, is understood as a student’s act or failure to act that makes it partially or fully impossible to correctly assess his/her knowledge, insight and skills. Plagiarism is understood as the presentation of one’s own or other people’s ideas or words without adequate reference to the source. Any assignment is an individual piece of work, which means that plagiarism is strictly forbidden.

Plagiarism can range from copying small or large pieces of other people's work, but also masking everything with different disguising techniques. This has been extensively studied, for example in:

  * Cheers, Hayden, Yuqing Lin, and Shamus P. Smith. "Academic Source Code Plagiarism Detection by Measuring Program Behavioral Similarity." IEEE Access 9 (2021): 50391-50412.

If you consult a book to check the syntax of a statement, you do not need to cite it. However, if you copy an example, or even borrow ideas for the solution of problem (including stackexchange), you are required to provide a URL or other citation. Examples provided in class do not require any citation.


# *Fatalities and Beer tax increase*

We make use of a modified version of the dataset Fatalities from the AER package which is a panel dataset reporting annual state level observations on U.S. traffic fatalities for the period 1982 through 1988. The applications analyze if there are effects of alcohol taxes and drunk driving laws on road fatalities and, if present, how strong these effects are. The research question and data are analyzed in the paper
[Ruhm, C. J. (1996). Alcohol Policies and Highway Vehicle Fatalities. Journal of Health Economics, 15, 435–454.](https://www.sciencedirect.com/science/article/pii/S0167629696004900)

Reducing the number and fatality of traffic accidents has been a main concern of governments and regulating agencies. For this purpose, several solutions have been proposed, ranging from fining risk factors for traffic accidents to investing in better road infrastructure. An economic claim is that increasing taxes on alcoholic beverages, such as beer, should discourage drunk driving. This decrease in drunk driving in turn is expected to decrease the fatality of traffic accidents. In this assignment, you will analyze whether this economic expectation holds in the provided dataset.

The dataset includes annual data related to beer taxes, fatalities in traffic accidents and several other potentially relevant variables between (including) 1982 and 1988 from 48 US states excluding Alaska and Hawaii. 

The variables in the dataset are:

  * 'state' factor indicating state.
  * 'year' factor indicating year.
  * 'tax_increase' factor indicating if the state increased beer taxes during 1986-1988 compared to the earlier period 1982-1985. 
  * 'fatal_rate_factor' factor indicating a above (1) or below (0) average fatality rate.
  * 'beertax_factor' factor indicating a above (1) or below (0) average beer tax.
  * 'fatal_rate' Traffic fatalities as a percentage of population, multiplied by 10000.
  * 'afatal_rate' Number of alcohol-involved vehicle fatalities as a percentage of total traffic fatalities.
  * 'beertax' Tax on case of beer.
  * 'spirits' Spirits consumption.
  * 'unemp' Unemployment rate.
  * 'drinkage' Minimum legal drinking age. 
  * 'youngdrivers' Percent of drivers aged 15–24.
  * 'breath' factor indicating the existence of a preliminary breath test law (1) or the lack of it (0).
  * 'jail' factor indicating mandatory jail sentence (1) or the lack of it (0).
  * 'dry' Percent residing in “dry” countries.

In this study, you are interested in using at least three different methods that you studied to answer the research question: **Does increasing taxes on alcoholic beverages, such as beer, decrease fatalities in traffic accidents?** You are required to break this main research question into sub-questions and clearly explain your reasoning for the sub-research question but also on the application of a given methodology and provide an in depth analysis (including checking model assumptions).

The methods covered in this course are:

  * Regression Analysis
  * Interactions and AN(C)OVA
  * Diff-in-Diff
  * Panel Data.

The dataset has several peculiarities that can be considered for the models to address this research question: The data spans multiple years where the nature of traffic accidents can be different; factors other than beer tax can affect fatalities; drunk driving can be more penalized or less socially acceptable in some states regardless of taxes, thus the impact of beer taxes can differ between states; the effect of the tax can depend on other covariates such as the overall consumption of spirits. The dataset consists of variables which directly relate to the link between beer taxes and traffic fatalities, but also additional variables explained at the end of the question.

Examples of sub-research questions are:

  1. Do fatalities in traffic accidents differ between states that increased beer taxes compared to the other states?
  2. Is there an effect of beer taxes on fatalities in traffic accidents, for a particular year?
  3. Do states that increase beer taxes during 1986-1988 experience a decrease in fatalities as compared to states that do not increase the beer taxes in the same period?
  4. What is the effect of increasing beer taxes on fatalities in traffic accidents over all different states and years?

Note that these are examples of questions, but you are expected to add further well supported sub-research questions accompanied by the respective analyses.



#Does increasing taxes on alcoholic beverages, such as beer, decrease fatalities in traffic accidents?

**INTRODUCTION TO THE RESARACH**

**In 80s it became a growing concern whether or not to increase beer taxes across the United States. Therefore, the aim of the research is to investigate whether the increase in beer taxes decreases the traffic fatality rate. Moreover, the research goes further and attempts to reveal whether beer taxes in fact decreases alcohol related fatality rate.**
**The research applies multiple statistical methods to find support for the economic theory which claims that increase in alcohol taxes in return decreases traffic fatalities. The structure of the research is as follows. Firstly, it attempts to run linear regression to see whether there is a relationship between increase in taxes and fatalities as well as the portion of fatalities related to alcohol only. Secondly, it runs interaction analysis to portray interactions between years and increase in taxes and its effect on traffic fatalities as well as the traffic fatalities only related to alcohol. Thirdly, the research runs Diff-in-Diff analysis to explore whether there is a difference between fatalities in states that increased and did not increase taxes across time. It explores differences between treatment and post treatment. Consequently, the research runs more Diff-in-Diff analysis to check for other controlling variables as well as to check the difference in fatalities related to alcohol. Then, the research explored panel data across different states and years and the effect of beertax. Finally, the research concludes its findings.**


**In order to answer this complex questions I am going to run statistical analyses to achieve results from data that will help me answer this main questions**

```{r}
#Firstly, I need to lead data into R in order to run statistical analyses I need data.

install.packages("tidyverse")
load("USFatalities.Rdata")

#I need to load package tidyverse in order to be able to read data and also later to be able to visualize and plot results 
#I use function load() to load dataset in R

head(USFatalities)
#head function shows me if the dataet loaded and how its beginning looks like -> it reasures me that loading went well and I can continue with analysis

USFatalities$tax_increase <- as.factor(USFatalities$tax_increase)
#I change tax increase into a factor so I can work with the variable further -> I am overwriting it here in data set so I do not have to rewrite it every time I am writing code and using the variable 
#I use tax increase as a variable together with interval for my Diff-in-Diff regression => I use using tax increase to see if tax increase has a impact on fatalities rate

library('plm')
#import plm in order to run panel data - I will use it later but I will load it here
library('car') 
#import car library to create panel scatterplot - I will use it later but also load it here
library(ggplot2)
#library for plots and data visualization 
library(gplots)
#library for various R programming tools for data plotting
library(ggpubr)
#library for publications ready plots 
library(broom)
#library helps to clean up outputs of predictions and estimations and make them into tidy data
library(datasets)
#package from R to summarize datasets and variables
library(dplyr)
#helps with grammar of data manipulation 
library(emmeans)
#helps with model estimations and comparisons among groups after fitting 
library(forcats)
#library for working with categorical variables 
library(graphics)
#library for R graphics 
library(grDevices)
#library for colour of graphs 
library(quantmod)
#helping with quantitative financial modelling 
library(readr)
#helps to read excel and other rectangular text data
library(stats)
#helps to work with statistics 
library(stringr)
#support of common string operations
library(tidyquant)
#library for quantitative financial analysis 
library(tidyr)
#helps to tidy data
library(tidyverse)
#helps non-programmer to work with data using string commands in R it also contains other packages like ggplot which I called above

```
**In this code I am just loading packages and loading the data in order to work with them and answer questions below.**
**I loaded every library separate to demonstrate what different packages I had active (and why they are good to have active) when I finished my individual assignment**

**Now when data is loaded I can proceed with further steps**

**Additionally I would like to add them when I refer to fatality I am referring to fatality rate and when I refer to fatality rate related with alcohol I am refering to portion of fatality rate that has been due to or related to alcohol only.**




##1. Do fatalities in traffic accidents differ between states that increased beer taxes compared to the other states?

**I decided to answer proposed questions from the assignment and to add few of my own to not only demonstrate my R and data analytics skill but to also answer the main research questions.**
**This question is relevant to the research as it first attempts to see whether there is a difference between states that increased the beer taxes and states that did not do so to find a prove whether increase in taxes reduces fatality rate** 


```{r}
plot_violin <- ggplot(USFatalities, aes(x=tax_increase, y=fatal_rate),) + geom_violin()
#this function shows plot in a beautiful violin visualization 
#in violin plot I plot tax increase on beer between 1986-1988 and traffic fatality rate.
plot_violin
plotmeans(fatal_rate ~ tax_increase, USFatalities)
#this is function that visualizes means and plots them too 
#(STHDA n.d.)
#In plot means I again plot beer tax increase between 1986-1988 and traffic fatality rate as it provides clearer visualization without portraying the full density curves of groups
plotmeans(fatal_rate ~ youngdrivers, USFatalities)
#I am trying to see whether young drivers have higher average of fatality rate accidents in traffic
plotmeans(fatal_rate ~ year, USFatalities)
#I am trying to visualize whether there are differences across years in fatality rates
plotmeans(afatal_rate ~ tax_increase, USFatalities)
#I am trying to see if beertax increase had is related with alcohol related traffic fatalities
```
**INTERPRETATION**
**In the first plot, violin we can see that countries that introduced beer tax increase show signs of traffic fatality rate higher than states that did not increase beer tax. Similar results we can see more clearly in the second graph. However, we cannot be sure because these are only plots. In order to confirm results statistically and to see whether there is correlation, I need to run statistical analysis. The difference between violin plot and plotmeans functions is that violin shows the distribution and plotmeans only plot means from the data and show confidence intervals, which visualize these type of data clearer**
**Additionally, I explored two more graphs. Third graph shows percentage of young drivers in different years and different states (as yougdrivers variable). I added this variable out of curiosity to see whether youg drivers have higher traffic fatality rate. This seems to be the case as the fatality rate seems to be higher on average for youg drivers in comparison with the previous graph.**
**Another additional graph is an attempt to visualize difference between fatality rate across years. It shows that in years 1986-1988 traffic fatality rate seems to stabilize but seems to be higher than previous years which seems to contradict the economic theory becasue these years are after the tax on beer have been introduced in some states.**
**However when I plot the fifth graph which plots traffic fatality rate caused by alcohol and tax increase on beer between 1986-1988. It shows that states that introduces the beer tax increase have less alcohol related traffic fatalities than states that did not introduced the tax which is in line with the economic theory that increase in alcohol taxes reduces the traffic fatalities.** 
**In order to answer the research question I cannot rely on graphs and I must run the statistical analysis** 


**ASSUMPTIONS - LINEAR REGREESION** 
**There must be certain assumptions met before I run a regression** 
**These are:** 
**1. Homoscedasticity - "residuals have constant variance at every point of the linear model" (Zach, 2021)**

**2. Normally distributed - "the residuals of the model are normally distributed" (Zach, 2021) -> in our data it is secured by central limit theorem saying that as long as our data has more than 40 observation assumption of normality is met**

**3. Independence - "the observations are independent" (Zach, 2021) - yes the data meets this assumption**

**4. Linearity - "There exists a linear relationship between each predictor variable and the response variable" (Zach, 2021)** 

**5. Multicollinearity - " none of the predictor variables are highly correlated with each other" (Zach, 2021) = only for multiple regression**

**6. Error term is normally distributed** 
(UM slides week 3, 2022) 

**To test for these assumptions I need to run a boxplots** 

```{r}
box_one <- boxplot(fatal_rate ~ tax_increase, USFatalities)
#here I am running boxplot to see if the assumptions are met 
box_one
#here I am calling boxplot to visualize it 
```
**INTERPRETATION**
**from the boxplot I can assume that assumptions have been met as the box plot show symmetricity and do not show anything abnormal for instance skewness. We can see few outliers but nothing abnormal. Therefore, we can assume that no violations have been violated.** 

```{r}
#Now, I am doing regression to confirm the correlation between beer tax increase and traffic fatality rate. However I cannot assess the causality from regression results 
simple_regression <- lm(fatal_rate ~ tax_increase, USFatalities)
#here I am running simple regression using lm() function
summary(simple_regression)
#summary() function shows me the results of my regression
```
**INTERPRETATION OF THE RESULTS OF SIMPLE REGRESSION** 
**According to the results from simple regression we can see positive and highly significant results which indicate that beer tax increase is positively related with increase in traffic fatality rate by 0.27606 % for 10000 people. Therefore the results seems to be against the economic theory claiming that increase in tax reduces traffic fatality rate.**

**However as we saw in our previous graphs we should also test alcohol related fatalities and increase in beer tax. I may assume that traffic fatality rate and beer tax increase positive relationship may be cause by different variables and the positive relationship is not caused by the beer tax increase**
**Therefore I also decided to add a new research question to see other relationship.**


**To confirm previous findings I decided to run a t-test**

```{r}
df_treatment_yes <- subset(USFatalities, tax_increase == TRUE)
#creates a data set which only consist of observations that increased taxes at some point
df_treatment_no <- subset(USFatalities, tax_increase == FALSE)
#creates a data set which only consist of observations that increased taxes at some point

#publications ready plots
t.test(df_treatment_no$fatal_rate, df_treatment_yes$fatal_rate, alternative = "two.sided", var.equal = FALSE)

```
**According to the t-test result there is a significant difference in means. Also I am rejecting the H0.** 



**MY RESEARCH QUESTION**
##2. Do number of alcohol involved fatalities in traffic accidents differ between states that increased beer taxes compared to the other states?

```{r}
#As previously explained, here I decided to run again regression to see if alcohol traffic fatality rate decreases or increases with beer tax increase or if it also goes against the economic theory

plotmeans(afatal_rate ~ tax_increase, USFatalities)
#Reminder that plotting beer tax increase difference between state and traffic fatalities showed positive relationship.  Therefore, in this simple regression I changed fatality traffic rate and substitute the variable with traffic fatality rate cause by alcohol influence. I did it in order to see if beer tax increase reduces or increase alcohol fatalities caused by alcohol consumption to show that previous results are indeed influenced by other variables. 

regression_two <- lm(afatal_rate ~ tax_increase, USFatalities)
#here I run regression to see if tax increase on beer in 1986-1988 is related with alcohol  fatality rate in traffic

summary(regression_two)
#function summary provides me with results of the regression

```
**INTERPRETATION** 
**The graph shows the results that alcohol related fatalities decrease with introduction of tax on beer. Therefore, countries that introduced tax on beer between 1986-1988 diminish the traffic fatalities caused by alcohol consumption. I can assume that the explanation for the previous regression in deed is due to other reasons influencing and increasing fatalities in states where beer tax increased.**
**The statistical output of the regression however tells us more importantly that these findings are significant and tax beer increase is significantly and negatively related with alcohol related fatalities in traffic.**



**GIVEN QUESTION 2**
##3. Is there an effect of beer taxes on fatalities in traffic accidents, for a particular year?
**In this question I am running interaction regression incorporating beertax per year between years 1982-1988**

**ASSUMPTIONS**
**1.Independence of observations**
**2.Normality** 
**3.Homogeneity of variance between groups** 
**(UM - presentation week 4, 2022)**



**here I am doing interaction which incorporates beertax per year - I want to see if the traffic fatality rate is depended on beertax for every year**
```{r}
interaction_regression <- lm(formula = fatal_rate ~ year * beertax, USFatalities)
#lm formula is a code that runs regression and interaction between fatalities rate and  year and beer tax interaction

interactions::interact_plot(interaction_regression, pred = beertax, modx = year, plot.points =  TRUE)
#here I am plotting the previous regression to visualize my results to better understand the output

summary(interaction_regression)
#running summary to see results of my interaction regression 
```
**INTERPRETATION**
**Firstly, the graphs shows slope for every year is increasing which shows interaction between beertax and year and showing how it affects the fatality rate. It shows that the fatality rate increases together with beertax over years as we can see that year over year the slope becomes steeper. However, when I read the statistical table the results except of the intercept are not significant. None of the interaction is significant. Therefore we conclude that year and beertax do not have statistically significant positive effect on fatality rate which is not aligned with the economic theory.**




**MY RESEARCH QUESTION** 
##4. Is there an effect of beer taxes on fatalities in traffic accidents related to alchol, for a particular year?

**I came up with this research question on the basis of the previous finding which found significant negative relationship between traffic fatalities related to alchol and increase in alchocol. Therefore, I continue with this example and attempts to find an effect of beertax on traffic fatalities related to alcohol. **


```{r}
interaction_regression_two <- lm(formula = afatal_rate ~ year * beertax, USFatalities)
#Interaction regression finding interaction of beertax and years on traffoc fatalities involving alcohol. 
interactions::interact_plot(interaction_regression_two, pred = beertax, modx = year, plot.points =  TRUE)
#Plotting interaction effect 
summary(interaction_regression_two)
#showimg statistical results of the interaction 


```

**INTERPRETATION**
**The graph shows that the slopes are not as steep but seems to be negative in some cases. Even though I expected significant negative results as previous regression suggested negative significant correlation between beertax and alcohol related fatalities, the truth is that the the interaction effect are not significant and seems to be mainly positive. Yet some years have a significant negative effect on alcohol related fatality rate these years are 1986, 1987, 1988 which are the years when the tax on beer has been introduced in some states. Therefore it seems to support the economic theory in some way.**




**GIVEN RESERACH QUESTION**

##5.  Do states that increase beer taxes during 1986-1988 experience a decrease in fatalities as compared to states that do not increase the beer taxes in the same period?*

**INTRODUCTION**
**In this part I am researching whether increase in taxes affects fatality rate. I chose to do Diff-in-Diff analysis because it measures sudden change for instance change in policy across treatment and untreated groups across time. A treatment effect is basically an intervention  that may change the outcome (independent variable = in this case the fatality rate) -> this change may answer the question how the independent variable and if it is influence by the treatment. (UM - slides week 5, 2022)**


```{r}
#firstly I decided to check differences in fatality rate between states who implemented treatment (increase in taxes) and who did not implemented any treatment based on mean values.


hist(df_treatment_yes$fatal_rate, col = blues9)
#this function generates histogram to see distribution of fatality rate and frequency of observation in group where taxes were increased 

hist(df_treatment_no$fatal_rate, col = "yellow" )
#this function generates histogram to see distribution of fatality rate and frequency of observation in group where taxes were not increased

summary(df_treatment_yes$fatal_rate)
#I use summary() to see the results data set analysis where there is increase in taxes and the fatal rate 

summary(df_treatment_no$fatal_rate)
#I use summary() to see the results data set analysis where there is increase in taxes and the fatal rate
```

**INTERPRETATION OF RESULTS**
**we can see that in the dataset where there was an increase in taxes the values are higher for fatality rate so there seems to be more fatalities in observations where taxes were increased. When we look at histograms we can see that frequency fatal rate decreases in frequency and shows positive skeweness. Therefore the data seems to breach normality assumption. When we look at the other histogram representing no change in taxes we can see the frequency is higher in comparison with the previous histogram but the distribution seems to be more normal and less spread - less outliers in fatality rate.**
**Both histograms also shows that it is not normally distributed the assumption is breached.**
**However we assume that parallel trend assumption holds otherwise we could not run the panel data regression.**


```{r}
USFatalities$interval <- ifelse(USFatalities$year == 1982, 0, ifelse(USFatalities$year == 1983, 0, ifelse(USFatalities$year == 1984, 0, ifelse(USFatalities$year == 1985,0, 1))))
#(Paddlebunk, 2018)
#this is to create a new column which shows divides observations into pre and post treatments in terms of time as we know that pre-tax time interval is 1982 till 1985 and and time interval when the tax increase was happening is from 1986 and more 


sum(USFatalities$year == 1982)
#I do not need to use pivot_longer() function because I have multiple data for multiple years and also same years have multiple data points -> for instance the code here shows that year 1982 has 48 rows = 48 observations

```
```{r}
did_regression <- lm(fatal_rate ~ tax_increase + interval + tax_increase*interval, data = USFatalities)
summary(did_regression)

#in this part of the code I run Diff-in-Diff regression -> Diff-in-diff shows the difference between states that incorporate tax increase and states that did not incorporate tax increase (tax_increase = variable) and pre and post treatment (interval = variable) = so states that did not increase their tax and states that did increase the tax on alcohol and time intervals between pre tax increase and post tax increase -> it shows whether increasing of tax rate decreases or increases fatalities rate in states -> according to the economic theory increase in tax rate on alcohol in states that incorporate the tax increase should decrease traffic fatality rate    
#I use summary() to see the results of Diff-in-Diff regression 
```

**INTERPRETATION OF DIFF-IN-DIFF REGRESSION RESULTS **
**The tax increase states have 0.37 higher traffic fatality rate than states that did not increase their taxes. This result is highly significant and positive. However, second estimator for interval - years before tax increase and years after tax increase do not have a significant influence on fatality rate for states without tax increase. The treatment effect is also not significant = meaning there is no treatment effect. Therefore, this model does not support economic theory that increase in tax reduces traffic fatality rate**  
**The reason for this can be due to spill-over effect that may be caused by people driving across states to buy cheaper alcohol and driving back drunk and causing fatalities or just by other factors that may increase fatality rate as for instance when state increase tax on alchol people buy drugs instead which increases ttafic fatalities.** 



**MY QUESTION**
##6.  Do states that increase beer taxes, have mandatory jail sentence and breath test in place  during 1986-1988 experience a decrease in fatalities as compared to states that do not increase the beer taxes in the same period?

```{r}
#because the previous results seems to be mission other intervening variables I decided to add more variables such as jail time and breath controls to see whether adding them decreases the fatality rate 
did_regression_extensive <- lm(fatal_rate ~ tax_increase + interval + tax_increase*interval + jail + breath, data = USFatalities)
summary(did_regression_extensive)
#I use summary() to see the results of Diff-in-Diff regression 
```
**INTERPRETATION OF DIFF-IN-DIFF OF MORE EXTENSIVE ANALYSIS AND THE RESULTS**
**Adjusted R squered of this model increased in comparison with the previous model indicating that this model is a better fit and is more reliable. Tax increase is again significant and positive which shows that increase in taxes is positively related to traffic fatality rate. The interval is again not significant, indicating that there is no relation between states without tax increase and with tax increase. Newly added jailtime mandatory variable is dummy and shows positive significant relationship to traffic fatality rate. This results is not aligned with the economic theory. In case of added variable breath test  shows that having breath test in place is negatively related with the traffic fatality rate, which is aligned with the economic theory. Unfortunately, the treatment effect is also not significant = meaning there is no treatment effect. The results overall goes again against the economic theory.** 



**MY QUESTION**
**In order to attempt to find explanation for previously unsuccessful tests and proving the economic theory I decided to run one more test only taking into account fatalities caused by the alchol consumption**



##7.  Do states that increase beer taxes, have mandatory jail sentence and breath test in place  during 1986-1988 experience a decrease in traffic fatalities caused by alcohol as compared to states that do not increase the beer taxes in the same period?

```{r}
did_regression_extensive_two <- lm(afatal_rate ~ tax_increase + interval + tax_increase*interval + jail + breath, data = USFatalities)
#difference in difference test to run the analysis
summary(did_regression_extensive_two)
#summary() function to see the results of the runned analysis
```
**INTERPRETATION**
**Even though the introduction of tax increase and breath test in place have are negatively related with the alcohol related traffic fatalities, the results are not significant. Therefore irrelevant and not aligned with the economic theory. Moreover, there is no treatment effect meaning that there is no difference between states post and pre treatment as the results are not significant. The only significant and negative results apply  to interval which seems to have negative relationship with alcohol related fatalities for states without introduction of tax increase. Therefore this diff-in-diff regression also goes against economic theory showing that there is no difference between states post and pre treatment and alcohol related traffic fatalities.**



**GIVEN QUESTION**
##8. What is the effect of increasing beer taxes on fatalities in traffic accidents over all different states and years?

**This question requires me to do panel data as I am looking at all states across years. Panel data takes into account common behavior of groups (Eric, 2021)**
**"Panel data allow me to observe development over time for set of individuals and allows me to identify and estimate effects that would be omitted in other way" (UM - slides Panel data, 2022, slide 5)**
**in this case Panel data gives me an opportunity to explore our research in different way and provide me with more insights**
**cross-sectional dimension = state** 
**year = time dimension or panel length**
**there is a difference between random and fixed effects -> random effect estimator allows to estimate the effects of time-invariant variables unlike fixed effect estimator. (UM - slides panel data, 2022)**
**The random effect H is usually not realistic (UM - slides panel data, 2022)** 
**the within model does not look across time period of the panel  data (across length) for all individuals. (UM - slides panel data, 2022)**
**The within model is alternative to fixed effect. (UM - slides panel data, 2022)**


```{r}
panel_df_USF <- pdata.frame(USFatalities, index= c("state", "year"))
#I do it to put year and states in chronological order
head(panel_df_USF)
#this shows me that I put states and years in chronological order to proceed with analysis
```
**ASSUMPTIONS**
**1. Linearity **
**2. Exogenieity**
**3. Homoskedasticity**
**4. Independency**
**5. No multicolinearity** 

**CHECKING ASSUMPTIONS** 

```{r}
plot(USFatalities$fatal_rate, USFatalities$beertax)
#we check for normality and linearity
abline(lm(USFatalities$fatal_rate ~ USFatalities$beertax), col= "blue")
#the linearity assumption seems not o be met 
#because the plot is spread it seems that heteroskedasticity has not been met
library(lmtest)
#I download this library to check for Breush-Pagan test which is used to check homoskedasticity
model_assumption_check <- lm(USFatalities$fatal_rate ~ USFatalities$beertax)
#model to be used for 
lmtest::bgtest(model_assumption_check)
# running Breush-Pagan test to check homoskedasticity
#(Coding Prof, 2022)
```
**INTERPRETATION**
**plot indicate other violations in terms of linearity and independence and violation of multicollinearity.**
**the p vale is significant highly = therefore homoscedasticity have not been met.**

```{r}
plotmeans(fatal_rate ~ state, USFatalities)
#I want to check if there is a differences in employment data across sectors (states)
```
**INTERPRETATION**
**I can see that there are great differences between states' fatality rates.**


```{r}
model_within <- plm(fatal_rate ~ beertax, data = USFatalities, model = "within")
#statistical regression model and function that is creating fixed effect estimator of beertax
#I decided not to run pooling because within model shows me the fixed effect estimator wich is my main concern 
summary(model_within)
#shows me results of the analysis
```
**INTERPRETATION**
**Beertax seems to have negative significant effect on fatality rates across states which is aligned with the economic theory.**


```{r}
model_random <- plm(fatal_rate ~ beertax, data = USFatalities, model = "random")
#function to run panel data model for random effect estimator 
summary(model_random)
#shows me results of the analysis
```
**INTERPRETATION**
**The random model shows us that the negative but insignificant results of beertax on traffic fatality rate. Therefore, we can assume that there is no random effect of beer tax on traffic fatality rate. It is not consistent with the economic theory.**


**we have to do hausemann test to decide which model to trust. If random or within fits better to our data** 
```{r}
phtest(model_within,model_random)
#this is function for hausemann test which checks for covariance 
```
**INTERPRETATION**
**Because the p value is very very small it indicates that random model is not consistent and I have to reject H0 -> meaning that I choose within model for my data as a model that I can trust. Therefore as I am trusting the within model results my results are aligned with the economic theory as the within model shows me that beertax has negative significant effect on traffic fatality rate.**
 
 
 
**MY QUESTION**
##9. What is the effect of increasing beer taxes on alcohol related fatalities in traffic accidents ver all different states and years?

**In order to answer this question I run model similar to previous model but only focus on fatalities related to alcohol** 

**firstly we have to check the assumptions** 


```{r}
plot(USFatalities$afatal_rate, USFatalities$beertax)
#we check for normality and linearity
#because the plot is spread it seems that heteroskedasticity has not been met
model_assumption_check_two <- lm(USFatalities$afatal_rate ~ USFatalities$beertax)
#model to be used for 
lmtest::bgtest(model_assumption_check_two)
# running Breush-Pagan test to check homoskedasticity
#(Coding Prof, 2022)
```
**INTERPRETATION**
**the plot does not indicate linarity and seems that other assumptions including Multicollinearity have not been met as in the previous graph.**
**the p vale is significant highly = therefore homoscedasticity have not been met**


```{r}
model_within_two <- plm(afatal_rate ~ beertax, data = USFatalities, model = "within")
#
summary(model_within_two)
#shows me results of the analysis
```
**INTERPRETATION**
**The result shows that the beertax have positive effect on alcohol related fatality rate. However, the results are not significant.** 



```{r}
model_random_two <- plm(afatal_rate ~ beertax, data = USFatalities, model = "random")
#function to run panal data pooled model for random effect estimator
summary(model_random_two)
#shows me results of the analysis
```
**INTERPRETATION**
**It indicates that beertax seems to have positive but insignificant effect on fatalities related to alcohol across states.**

```{r}
phtest(model_within_two,model_random_two)
#this is function for hausemann test which checks for covariance 
```
**INTERPRETATION**
**the p-value is large therefore I cannot reject H0 and the random model result -> meaning that alcohol related traffic fatalities increases after introduction of beer tax across states. Indicates that random model is consistent and I should use random model to draw a conclusion. However the result of the random model is not significant and also is not aligned with the economic theory. Therefore, in conclusion there is no correlation between beertax and alcohol related fatality rate. ** 




#Conclusion 

**Concluding the research findings's results are mostly not aligned with the economic theory according to which traffic fatalities decrease by increasing the tax on beer.** 
  **In this research I focused on beertax impact on traffic fatalities rate. Moreover, I decided to also research beertax impact on traffic fatalities rate only related to alcohol. I decided to run multiple tests in order to find support for the hypothesis that increasing beertax reduces traffic fatalities. Due to findings that indicate that in fact beertax does not decreases traffic fatalities visible in regression and Q1 results, I decided to research whether it support the economic theory at least from the point of decreasing traffic fatalities related to alcohol.**
  **For instance, even though Q1 suggest the increase in beer taxes is not related with decrease in traffic fatalities, Q2 result suggests there is a negative and significant correlation between beertax introduction in states and negative alcohol related traffic fatalities. Due to these findings I decided to deepen this research and to show that even though the beer tax increase may not be related to traffic fatalities decrease, it may be in fact related with fatality decrease related with alcohol. Such findings would support in fact the economic theory.**
  **When run interaction regression regarding beertax and traffic fatality in different years, the results are positive and in fact are not significant which is not in line in economic theory. However, when I analyse the beertax and traffic fatality rate related to alcohol I find more interesting findings. Even though, non of the interaction is significant the results at least seems to be negative for majority. Yet some years have a significant negative effect on alcohol related fatality rate. These years are 1986, 1987, 1988 which are the years when the tax on beer has been introduced in some states. Therefore it seems to support the economic theory to certain extent.**
  **Therefore the research proceeds further and attempts to run Diff-in-Diff regressions to see whether treatment had in fact effect firstly on traffic fatality rate and if the treatment had effect on alcohol related traffic fatalities. In fact most of the results go against the economic theory. In conclusion there is no difference between states post and pre treatment and traffic fatalities. Additionally, there is no difference between states post and pre treatment and alcohol related traffic fatalities.**
  **Finally, I attempt to research the data via panel data regressions. The first result indicates that the results are aligned with the economic theory as the within model shows me that beertax has negative significant effect on traffic fatality rate. However, the results for beertax in states and alcohol related traffic fatalities are not significant and are not in line with the economic theory.**
  **Additionally, during the research I found that data are breaching multiple assumptions which makes data not reliable and insufficient. Also due to the differences in results of test and inconsistencies with economic theory I assume that the results are not supporting the economic theory overall and the traffic fatalities including alcohol related traffic fatalities are in fact influenced by other unknown variables. One of my suggestions is the spillover effect for example alcohol drinkers to substitute alcohol for drugs and consequently causing more fatalities. This may be especially true as the crack crisis in USA is a symbol for 80s. However, I cannot be sure as the data set does not offer data for drug usage. Additionally, since the data are old from 80s I believe that the data does not take into account macroeconomic development of USA in 80s for instance increase in drivers across country. Additionally, in 80s US experienced economic recession which may have led to more people drinking. All these other variables are not tested and are result of my inductive reasoning.**
  **In conclusion, taxes increase seems to have effect on traffic fatalities to certain extent. In any case increase in taxes benefits the government leading to tax payers benefits.**






#Bibliography 


Coding Prof. (2022). 3 Easy ways to test for heteroscedasticity in R. https://www.codingprof.com/3-easy-ways-to-test-for-heteroscedasticity-in-r-examples/

Erick. (2021). Introduction to the Fundamentals of Panel Data. https://www.aptech.com/blog/introduction-to-the-fundamentals-of-panel-data/#:~:text=Panel%20data%20can%20model%20both,%2Dsectional%20data%20can't.

Paddlebunk. (2018). Add column with values depending on another column to dataframe [duplicate]. https://stackoverflow.com/questions/50988447/add-column-with-values-depending-on-another-column-to-a-dataframe 

UM slides week 3. (2022). DA Lecture Week 3 Regression 2022. https://canvas.maastrichtuniversity.nl/courses/12677/files/1905023?module_item_id=385764

UM slides week 4. (2022). W4_DA2223_presentation. https://canvas.maastrichtuniversity.nl/courses/12677/files/1927015?module_item_id=388540

UM slides week 5. (2022). DA_DiD. https://canvas.maastrichtuniversity.nl/courses/12677/files/1955068?module_item_id=391796

UM - slides Panel data. (2022). DA_panel_data. https://canvas.maastrichtuniversity.nl/courses/12677/files/1981727?module_item_id=395435 

STHDA. (n.d.). ggplot2 violin plot: Quick start guide - R software and data visualisation. http://www.sthda.com/english/wiki/ggplot2-violin-plot-quick-start-guide-r-software-and-data-visualization

Zach. (2021) The five assumptions of multiple linear regression. https://www.statology.org/multiple-linear-regression-assumptions/ 